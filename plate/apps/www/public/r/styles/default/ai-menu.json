{
  "dependencies": [
    "@udecode/plate-ai",
    "@udecode/plate-markdown",
    "@udecode/plate-selection",
    "ai",
    "@faker-js/faker"
  ],
  "doc": {
    "description": "A menu for AI-powered content generation and insertion.",
    "docs": [
      {
        "route": "/docs/ai",
        "title": "AI"
      },
      {
        "route": "https://pro.platejs.org/docs/components/ai-menu",
        "title": "AI Menu"
      }
    ],
    "examples": [
      "ai-demo",
      "ai-pro"
    ],
    "label": "New",
    "title": "AI Menu"
  },
  "files": [
    {
      "path": "plate-ui/ai-menu.tsx",
      "content": "'use client';\n\nimport * as React from 'react';\n\nimport { type NodeEntry, isHotkey } from '@udecode/plate';\nimport {\n  AIChatPlugin,\n  useEditorChat,\n  useLastAssistantMessage,\n} from '@udecode/plate-ai/react';\nimport {\n  BlockSelectionPlugin,\n  useIsSelecting,\n} from '@udecode/plate-selection/react';\nimport {\n  useEditorPlugin,\n  useHotkeys,\n  usePluginOption,\n} from '@udecode/plate/react';\nimport { Loader2Icon } from 'lucide-react';\n\nimport { useChat } from '@/components/editor/use-chat';\n\nimport { AIChatEditor } from './ai-chat-editor';\nimport { AIMenuItems } from './ai-menu-items';\nimport { Command, CommandList, InputCommand } from './command';\nimport { Popover, PopoverAnchor, PopoverContent } from './popover';\n\nexport function AIMenu() {\n  const { api, editor } = useEditorPlugin(AIChatPlugin);\n  const open = usePluginOption(AIChatPlugin, 'open');\n  const mode = usePluginOption(AIChatPlugin, 'mode');\n  const isSelecting = useIsSelecting();\n\n  const [value, setValue] = React.useState('');\n\n  const chat = useChat();\n\n  const { input, isLoading, messages, setInput } = chat;\n  const [anchorElement, setAnchorElement] = React.useState<HTMLElement | null>(\n    null\n  );\n\n  const content = useLastAssistantMessage()?.content;\n\n  const setOpen = (open: boolean) => {\n    if (open) {\n      api.aiChat.show();\n    } else {\n      api.aiChat.hide();\n    }\n  };\n\n  const show = (anchorElement: HTMLElement) => {\n    setAnchorElement(anchorElement);\n    setOpen(true);\n  };\n\n  useEditorChat({\n    chat,\n    onOpenBlockSelection: (blocks: NodeEntry[]) => {\n      show(editor.api.toDOMNode(blocks.at(-1)![0])!);\n    },\n    onOpenChange: (open) => {\n      if (!open) {\n        setAnchorElement(null);\n        setInput('');\n      }\n    },\n    onOpenCursor: () => {\n      const [ancestor] = editor.api.block({ highest: true })!;\n\n      if (!editor.api.isAt({ end: true }) && !editor.api.isEmpty(ancestor)) {\n        editor\n          .getApi(BlockSelectionPlugin)\n          .blockSelection.set(ancestor.id as string);\n      }\n\n      show(editor.api.toDOMNode(ancestor)!);\n    },\n    onOpenSelection: () => {\n      show(editor.api.toDOMNode(editor.api.blocks().at(-1)![0])!);\n    },\n  });\n\n  useHotkeys(\n    'meta+j',\n    () => {\n      api.aiChat.show();\n    },\n    { enableOnContentEditable: true, enableOnFormTags: true }\n  );\n\n  return (\n    <Popover open={open} onOpenChange={setOpen} modal={false}>\n      <PopoverAnchor virtualRef={{ current: anchorElement! }} />\n\n      <PopoverContent\n        className=\"border-none bg-transparent p-0 shadow-none\"\n        style={{\n          width: anchorElement?.offsetWidth,\n        }}\n        onEscapeKeyDown={(e) => {\n          e.preventDefault();\n\n          if (isLoading) {\n            api.aiChat.stop();\n          } else {\n            api.aiChat.hide();\n          }\n        }}\n        align=\"center\"\n        // avoidCollisions={false}\n        side=\"bottom\"\n      >\n        <Command\n          className=\"w-full rounded-lg border shadow-md\"\n          value={value}\n          onValueChange={setValue}\n        >\n          {mode === 'chat' && isSelecting && content && (\n            <AIChatEditor content={content} />\n          )}\n\n          {isLoading ? (\n            <div className=\"flex grow items-center gap-2 p-2 text-sm text-muted-foreground select-none\">\n              <Loader2Icon className=\"size-4 animate-spin\" />\n              {messages.length > 1 ? 'Editing...' : 'Thinking...'}\n            </div>\n          ) : (\n            <InputCommand\n              variant=\"ghost\"\n              className=\"rounded-none border-b border-solid border-border [&_svg]:hidden\"\n              value={input}\n              onKeyDown={(e) => {\n                if (isHotkey('backspace')(e) && input.length === 0) {\n                  e.preventDefault();\n                  api.aiChat.hide();\n                }\n                if (isHotkey('enter')(e) && !e.shiftKey && !value) {\n                  e.preventDefault();\n                  void api.aiChat.submit();\n                }\n              }}\n              onValueChange={setInput}\n              placeholder=\"Ask AI anything...\"\n              data-plate-focus\n              autoFocus\n            />\n          )}\n\n          {!isLoading && (\n            <CommandList>\n              <AIMenuItems setValue={setValue} />\n            </CommandList>\n          )}\n        </Command>\n      </PopoverContent>\n    </Popover>\n  );\n}\n",
      "type": "registry:ui",
      "target": "components/plate-ui/ai-menu.tsx"
    },
    {
      "path": "plate-ui/ai-menu-items.tsx",
      "content": "'use client';\n\nimport { useEffect, useMemo } from 'react';\n\nimport { type SlateEditor, NodeApi } from '@udecode/plate';\nimport { AIChatPlugin, AIPlugin } from '@udecode/plate-ai/react';\nimport { useIsSelecting } from '@udecode/plate-selection/react';\nimport {\n  type PlateEditor,\n  useEditorRef,\n  usePluginOption,\n} from '@udecode/plate/react';\nimport {\n  Album,\n  BadgeHelp,\n  Check,\n  CornerUpLeft,\n  FeatherIcon,\n  ListEnd,\n  ListMinus,\n  ListPlus,\n  PenLine,\n  SmileIcon,\n  Wand,\n  X,\n} from 'lucide-react';\n\nimport { CommandGroup, CommandItem } from './command';\n\nexport type EditorChatState =\n  | 'cursorCommand'\n  | 'cursorSuggestion'\n  | 'selectionCommand'\n  | 'selectionSuggestion';\n\nexport const aiChatItems = {\n  accept: {\n    icon: <Check />,\n    label: 'Accept',\n    value: 'accept',\n    onSelect: ({ editor }) => {\n      editor.getTransforms(AIChatPlugin).aiChat.accept();\n      editor.tf.focus({ edge: 'end' });\n    },\n  },\n  continueWrite: {\n    icon: <PenLine />,\n    label: 'Continue writing',\n    value: 'continueWrite',\n    onSelect: ({ editor }) => {\n      const ancestorNode = editor.api.block({ highest: true });\n\n      if (!ancestorNode) return;\n\n      const isEmpty = NodeApi.string(ancestorNode[0]).trim().length === 0;\n\n      void editor.getApi(AIChatPlugin).aiChat.submit({\n        mode: 'insert',\n        prompt: isEmpty\n          ? `<Document>\n{editor}\n</Document>\nStart writing a new paragraph AFTER <Document> ONLY ONE SENTENCE`\n          : 'Continue writing AFTER <Block> ONLY ONE SENTENCE. DONT REPEAT THE TEXT.',\n      });\n    },\n  },\n  discard: {\n    icon: <X />,\n    label: 'Discard',\n    shortcut: 'Escape',\n    value: 'discard',\n    onSelect: ({ editor }) => {\n      editor.getTransforms(AIPlugin).ai.undo();\n      editor.getApi(AIChatPlugin).aiChat.hide();\n    },\n  },\n  emojify: {\n    icon: <SmileIcon />,\n    label: 'Emojify',\n    value: 'emojify',\n    onSelect: ({ editor }) => {\n      void editor.getApi(AIChatPlugin).aiChat.submit({\n        prompt: 'Emojify',\n      });\n    },\n  },\n  explain: {\n    icon: <BadgeHelp />,\n    label: 'Explain',\n    value: 'explain',\n    onSelect: ({ editor }) => {\n      void editor.getApi(AIChatPlugin).aiChat.submit({\n        prompt: {\n          default: 'Explain {editor}',\n          selecting: 'Explain',\n        },\n      });\n    },\n  },\n  fixSpelling: {\n    icon: <Check />,\n    label: 'Fix spelling & grammar',\n    value: 'fixSpelling',\n    onSelect: ({ editor }) => {\n      void editor.getApi(AIChatPlugin).aiChat.submit({\n        prompt: 'Fix spelling and grammar',\n      });\n    },\n  },\n  improveWriting: {\n    icon: <Wand />,\n    label: 'Improve writing',\n    value: 'improveWriting',\n    onSelect: ({ editor }) => {\n      void editor.getApi(AIChatPlugin).aiChat.submit({\n        prompt: 'Improve the writing',\n      });\n    },\n  },\n  insertBelow: {\n    icon: <ListEnd />,\n    label: 'Insert below',\n    value: 'insertBelow',\n    onSelect: ({ aiEditor, editor }) => {\n      void editor.getTransforms(AIChatPlugin).aiChat.insertBelow(aiEditor);\n    },\n  },\n  makeLonger: {\n    icon: <ListPlus />,\n    label: 'Make longer',\n    value: 'makeLonger',\n    onSelect: ({ editor }) => {\n      void editor.getApi(AIChatPlugin).aiChat.submit({\n        prompt: 'Make longer',\n      });\n    },\n  },\n  makeShorter: {\n    icon: <ListMinus />,\n    label: 'Make shorter',\n    value: 'makeShorter',\n    onSelect: ({ editor }) => {\n      void editor.getApi(AIChatPlugin).aiChat.submit({\n        prompt: 'Make shorter',\n      });\n    },\n  },\n  replace: {\n    icon: <Check />,\n    label: 'Replace selection',\n    value: 'replace',\n    onSelect: ({ aiEditor, editor }) => {\n      void editor.getTransforms(AIChatPlugin).aiChat.replaceSelection(aiEditor);\n    },\n  },\n  simplifyLanguage: {\n    icon: <FeatherIcon />,\n    label: 'Simplify language',\n    value: 'simplifyLanguage',\n    onSelect: ({ editor }) => {\n      void editor.getApi(AIChatPlugin).aiChat.submit({\n        prompt: 'Simplify the language',\n      });\n    },\n  },\n  summarize: {\n    icon: <Album />,\n    label: 'Add a summary',\n    value: 'summarize',\n    onSelect: ({ editor }) => {\n      void editor.getApi(AIChatPlugin).aiChat.submit({\n        mode: 'insert',\n        prompt: {\n          default: 'Summarize {editor}',\n          selecting: 'Summarize',\n        },\n      });\n    },\n  },\n  tryAgain: {\n    icon: <CornerUpLeft />,\n    label: 'Try again',\n    value: 'tryAgain',\n    onSelect: ({ editor }) => {\n      void editor.getApi(AIChatPlugin).aiChat.reload();\n    },\n  },\n} satisfies Record<\n  string,\n  {\n    icon: React.ReactNode;\n    label: string;\n    value: string;\n    component?: React.ComponentType<{ menuState: EditorChatState }>;\n    filterItems?: boolean;\n    items?: { label: string; value: string }[];\n    shortcut?: string;\n    onSelect?: ({\n      aiEditor,\n      editor,\n    }: {\n      aiEditor: SlateEditor;\n      editor: PlateEditor;\n    }) => void;\n  }\n>;\n\nconst menuStateItems: Record<\n  EditorChatState,\n  {\n    items: (typeof aiChatItems)[keyof typeof aiChatItems][];\n    heading?: string;\n  }[]\n> = {\n  cursorCommand: [\n    {\n      items: [\n        aiChatItems.continueWrite,\n        aiChatItems.summarize,\n        aiChatItems.explain,\n      ],\n    },\n  ],\n  cursorSuggestion: [\n    {\n      items: [aiChatItems.accept, aiChatItems.discard, aiChatItems.tryAgain],\n    },\n  ],\n  selectionCommand: [\n    {\n      items: [\n        aiChatItems.improveWriting,\n        aiChatItems.emojify,\n        aiChatItems.makeLonger,\n        aiChatItems.makeShorter,\n        aiChatItems.fixSpelling,\n        aiChatItems.simplifyLanguage,\n      ],\n    },\n  ],\n  selectionSuggestion: [\n    {\n      items: [\n        aiChatItems.replace,\n        aiChatItems.insertBelow,\n        aiChatItems.discard,\n        aiChatItems.tryAgain,\n      ],\n    },\n  ],\n};\n\nexport const AIMenuItems = ({\n  setValue,\n}: {\n  setValue: (value: string) => void;\n}) => {\n  const editor = useEditorRef();\n  const { messages } = usePluginOption(AIChatPlugin, 'chat');\n  const aiEditor = usePluginOption(AIChatPlugin, 'aiEditor')!;\n  const isSelecting = useIsSelecting();\n\n  const menuState = useMemo(() => {\n    if (messages && messages.length > 0) {\n      return isSelecting ? 'selectionSuggestion' : 'cursorSuggestion';\n    }\n\n    return isSelecting ? 'selectionCommand' : 'cursorCommand';\n  }, [isSelecting, messages]);\n\n  const menuGroups = useMemo(() => {\n    const items = menuStateItems[menuState];\n\n    return items;\n  }, [menuState]);\n\n  useEffect(() => {\n    if (menuGroups.length > 0 && menuGroups[0].items.length > 0) {\n      setValue(menuGroups[0].items[0].value);\n    }\n  }, [menuGroups, setValue]);\n\n  return (\n    <>\n      {menuGroups.map((group, index) => (\n        <CommandGroup key={index} heading={group.heading}>\n          {group.items.map((menuItem) => (\n            <CommandItem\n              key={menuItem.value}\n              className=\"[&_svg]:text-muted-foreground\"\n              value={menuItem.value}\n              onSelect={() => {\n                menuItem.onSelect?.({\n                  aiEditor,\n                  editor: editor,\n                });\n              }}\n            >\n              {menuItem.icon}\n              <span>{menuItem.label}</span>\n            </CommandItem>\n          ))}\n        </CommandGroup>\n      ))}\n    </>\n  );\n};\n",
      "type": "registry:ui",
      "target": "components/plate-ui/ai-menu-items.tsx"
    },
    {
      "path": "plate-ui/ai-chat-editor.tsx",
      "content": "'use client';\n\nimport React, { memo } from 'react';\n\nimport { withProps } from '@udecode/cn';\nimport { BaseParagraphPlugin, SlateLeaf } from '@udecode/plate';\nimport { useAIChatEditor } from '@udecode/plate-ai/react';\nimport {\n  BaseBoldPlugin,\n  BaseCodePlugin,\n  BaseItalicPlugin,\n  BaseStrikethroughPlugin,\n  BaseUnderlinePlugin,\n} from '@udecode/plate-basic-marks';\nimport { BaseBlockquotePlugin } from '@udecode/plate-block-quote';\nimport {\n  BaseCodeBlockPlugin,\n  BaseCodeLinePlugin,\n  BaseCodeSyntaxPlugin,\n} from '@udecode/plate-code-block';\nimport { BaseHeadingPlugin, HEADING_KEYS } from '@udecode/plate-heading';\nimport { BaseHorizontalRulePlugin } from '@udecode/plate-horizontal-rule';\nimport { BaseIndentPlugin } from '@udecode/plate-indent';\nimport { BaseIndentListPlugin } from '@udecode/plate-indent-list';\nimport { BaseLinkPlugin } from '@udecode/plate-link';\nimport { MarkdownPlugin } from '@udecode/plate-markdown';\nimport { usePlateEditor } from '@udecode/plate/react';\n\nimport {\n  TodoLiStatic,\n  TodoMarkerStatic,\n} from '@/components/plate-ui/indent-todo-marker-static';\n\nimport { BlockquoteElementStatic } from './blockquote-element-static';\nimport { CodeBlockElementStatic } from './code-block-element-static';\nimport { CodeLeafStatic } from './code-leaf-static';\nimport { CodeLineElementStatic } from './code-line-element-static';\nimport { CodeSyntaxLeafStatic } from './code-syntax-leaf-static';\nimport { EditorStatic } from './editor-static';\nimport { HeadingElementStatic } from './heading-element-static';\nimport { HrElementStatic } from './hr-element-static';\nimport { LinkElementStatic } from './link-element-static';\nimport { ParagraphElementStatic } from './paragraph-element-static';\n\nconst components = {\n  [BaseBlockquotePlugin.key]: BlockquoteElementStatic,\n  [BaseBoldPlugin.key]: withProps(SlateLeaf, { as: 'strong' }),\n  [BaseCodeBlockPlugin.key]: CodeBlockElementStatic,\n  [BaseCodeLinePlugin.key]: CodeLineElementStatic,\n  [BaseCodePlugin.key]: CodeLeafStatic,\n  [BaseCodeSyntaxPlugin.key]: CodeSyntaxLeafStatic,\n  [BaseHorizontalRulePlugin.key]: HrElementStatic,\n  [BaseItalicPlugin.key]: withProps(SlateLeaf, { as: 'em' }),\n  [BaseLinkPlugin.key]: LinkElementStatic,\n  [BaseParagraphPlugin.key]: ParagraphElementStatic,\n  [BaseStrikethroughPlugin.key]: withProps(SlateLeaf, { as: 's' }),\n  [BaseUnderlinePlugin.key]: withProps(SlateLeaf, { as: 'u' }),\n  [HEADING_KEYS.h1]: withProps(HeadingElementStatic, { variant: 'h1' }),\n  [HEADING_KEYS.h2]: withProps(HeadingElementStatic, { variant: 'h2' }),\n  [HEADING_KEYS.h3]: withProps(HeadingElementStatic, { variant: 'h3' }),\n};\n\nconst plugins = [\n  BaseBlockquotePlugin,\n  BaseBoldPlugin,\n  BaseCodeBlockPlugin,\n  BaseCodeLinePlugin,\n  BaseCodePlugin,\n  BaseCodeSyntaxPlugin,\n  BaseItalicPlugin,\n  BaseStrikethroughPlugin,\n  BaseUnderlinePlugin,\n  BaseHeadingPlugin,\n  BaseHorizontalRulePlugin,\n  BaseLinkPlugin,\n  BaseParagraphPlugin,\n  BaseIndentPlugin.extend({\n    inject: {\n      targetPlugins: [BaseParagraphPlugin.key],\n    },\n  }),\n  BaseIndentListPlugin.extend({\n    inject: {\n      targetPlugins: [BaseParagraphPlugin.key],\n    },\n    options: {\n      listStyleTypes: {\n        todo: {\n          liComponent: TodoLiStatic,\n          markerComponent: TodoMarkerStatic,\n          type: 'todo',\n        },\n      },\n    },\n  }),\n  MarkdownPlugin.configure({ options: { indentList: true } }),\n];\n\nexport const AIChatEditor = memo(({ content }: { content: string }) => {\n  const aiEditor = usePlateEditor({\n    plugins,\n  });\n\n  useAIChatEditor(aiEditor, content);\n\n  return (\n    <EditorStatic variant=\"aiChat\" components={components} editor={aiEditor} />\n  );\n});\n",
      "type": "registry:ui",
      "target": "components/plate-ui/ai-chat-editor.tsx"
    }
  ],
  "name": "ai-menu",
  "registryDependencies": [
    "use-chat",
    "command",
    "popover",
    "editor"
  ],
  "type": "registry:ui",
  "$schema": "https://platejs.org/schema/registry-item.json",
  "author": "udecode (https://platejs.org)"
}